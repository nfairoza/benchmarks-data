#!/bin/bash
. ./benchmarks_environment.sh
PATH=/bin:/usr/bin:/usr/sbin:$PATH

# Telemetry wrapper around the benchmarks
function startprofiling {
	nohup bash ./binaries/perfspect/start_perfspect.sh $DIR $1 >> $DIR/LOG 2>&1 &
}

function stopprofiling {
	nohup bash ./binaries/perfspect/stop_perfspect.sh >> $DIR/LOG 2>&1 &
	sleep 10
}
#ALL Benchmark TESTS
echo "Benchmarks started at: $DATE " >>$DIR/INFO

# Check if multiple containers are running
if [[ -z "$GROUP" ]]; then
    echo " Running MLC..."
    startprofiling mlc
    ./benchmarks/mlc.py
    stopprofiling
else
    echo "⚠️ Skipping MLC benchmark because multiple containers are running (GROUP=$GROUP)." | tee -a $DIR/INFO
fi

echo " Running compress-7zip..."
startprofiling compress-7zip
./benchmarks/compress-7zip.py
stopprofiling
#
#startprofiling ffmpeg
#/usr/share/autobench/java17-benchmarks/ffmpeg.py
#stopprofiling
#
echo " Running SpecJVM..."
startprofiling specjvm2008
./benchmarks/specjvm2008.py
stopprofiling
#
echo " Running Renaissance..."
startprofiling renaissance
./benchmarks/renaissance.py
stopprofiling
#
echo " Running lmbench-bw..."
startprofiling lmbench-bw
./benchmarks/lmbench-bw.py
stopprofiling
#
#startprofiling lmbench-mhz
#/usr/share/autobench/java17-benchmarks/lmbench-mhz.py
#stopprofiling
#
echo " Running lmbench-mem..."
startprofiling lmbench-mem
./benchmarks/lmbench-mem.py
stopprofiling
#
echo " Running lmbench-ops..."
startprofiling lmbench-ops
./benchmarks/lmbench-ops.py
stopprofiling
#
echo " Running openssl..."
startprofiling openssl
./benchmarks/openssl.py
stopprofiling
#
echo " Running stream..."
startprofiling stream
./benchmarks/stream.py
stopprofiling
#
echo " Running sysbench-cpu..."
startprofiling sysbench-cpu
./benchmarks/sysbench-cpu.py
stopprofiling
#
echo " Running sysbench-mem..."
startprofiling sysbench-mem
./benchmarks/sysbench-mem.py
stopprofiling
#
#startprofiling ffmpeg-downsampler-encode.sh
#./benchmarks/ffmpeg-downsampler-encode.sh
#stopprofiling
#
#startprofiling ffmpeg-h264-prores_encode.sh
#./benchmarks/ffmpeg-h264-prores_encode.sh
#stopprofiling
#
#startprofiling ffmpeg-h264-j2k_encode.sh
#./benchmarks/ffmpeg-h264-j2k_encode.sh
#stopprofiling
#
#startprofiling ffmpeg-vmaf.sh
#./benchmarks/ffmpeg-vmaf.sh
#stopprofiling
#
echo " Running specJBB..."
startprofiling specjbb2015
./benchmarks/specjbb2015.sh
stopprofiling
#
# Copy to LATEST Directory
if [[ -z "$GROUP" ]]; then
cp -r $DIR/* $LDIR
fi
DATE=$(date '+%m-%d-%Y_%H-%M')
echo "Benchmarks ended at: $DATE" >> $DIR/INFO
